import React, { MutableRefObject } from 'react';
import { Text, View, TouchableOpacity, StyleSheet } from 'react-native';
import type { SketchCanvasRef } from 'rn-perfect-sketch-canvas';
import type { CurvesDump } from 'src/store';
import { state } from '../store';
import Util from '../utils';

interface Props {
  canvasRef: MutableRefObject<SketchCanvasRef | null>;
}

const Header: React.FC<Props> = ({ canvasRef }) => {
  /**
   * Reset the canvas & draw state
   */
  const reset = () => {
    canvasRef.current?.reset();
    state.strokeColor = 'black';
    state.strokeWidth = 8;
  };

  const save = () => {
    const points = canvasRef.current?.toPoints();
    if (points) {
      console.log('Points', JSON.stringify(points));
    }
    /* const data = [
      [
        1653138289.022,
        {
          points: [
            [82.13333333333334, 98.4888888888889],
            [82.13333333333334, 98.4888888888889],
            [82.13333333333334, 98.4888888888889],
            [82.51639539930555, 98.8719509548611],
            [83.21624348958333, 101.01025390625],
            [86.28728298611111, 105.7751953125],
            [93.64624565972223, 114.56892361111112],
            [105.56759982638889, 129.9052734375],
            [118.89797092013889, 146.73012152777778],
            [125.40372178819445, 156.36193576388888],
            [128.9969943576389, 162.10028211805556],
            [131.17796223958334, 165.5409939236111],
            [132.90389539930555, 167.74832899305557],
            [134.61953125, 169.2722873263889],
            [136.69178602430554, 170.12688802083332],
            [139.40930989583333, 170.16258680555555],
            [144.29322916666666, 168.31497395833333],
            [150.15614149305554, 164.0612847222222],
            [157.79878472222222, 153.57198350694443],
            [166.89654947916668, 138.66336805555557],
            [173.2015842013889, 127.36508246527778],
            [177.83166232638888, 118.29223090277777],
            [180.88780381944446, 112.28617621527778],
            [183.2566623263889, 108.22610677083334],
            [185.91818576388889, 105.27432725694445],
            [190.62855902777778, 100.93424479166667],
            [195.1302951388889, 97.48030598958333],
            [197.97003038194444, 95.69405381944445],
            [199.3732204861111, 94.62450086805555],
            [199.82222222222222, 94.4],
            [199.46666666666667, 94.57777777777778],
          ],
          width: 8,
          color: 'black',
          style: 'fill',
        },
      ],
      [
        1653138289.713,
        {
          points: [
            [172.8, 111.64444444444445],
            [172.8, 111.64444444444445],
            [172.8, 111.64444444444445],
            [173.21228298611112, 112.46903211805555],
            [175.4201171875, 118.01694878472222],
            [182.1333984375, 134.62643229166667],
            [191.37491319444445, 156.2896267361111],
            [198.66217447916668, 169.78953993055555],
            [202.92003038194446, 175.51671006944446],
            [206.35093315972222, 177.0212890625],
            [210.83350694444445, 175.17764756944445],
            [216.23009982638888, 170.2587890625],
            [223.1337673611111, 160.77055121527778],
            [231.47847222222222, 149.3689453125],
            [242.36861979166667, 133.3359592013889],
            [252.49778645833334, 114.4724609375],
            [260.2753472222222, 101.39884982638888],
            [265.6422309027778, 94.16592881944445],
            [268.4339626736111, 90.50461154513889],
            [269.67230902777777, 89.08324652777777],
            [270.0444444444444, 88.71111111111111],
            [269.8666666666667, 88.88888888888889],
          ],
          width: 8,
          color: 'black',
          style: 'fill',
        },
      ],
      [
        1653138290.607,
        {
          points: [
            [197.6888888888889, 266.6666666666667],
            [197.6888888888889, 266.6666666666667],
            [196.48133680555554, 266.33569878472224],
            [192.575, 265.0940972222222],
            [185.980859375, 264.39364149305555],
            [171.97569444444446, 266.9306640625],
            [158.4006293402778, 276.0322482638889],
            [149.8942165798611, 290.717578125],
            [147.08358289930555, 306.04986979166665],
            [148.84240451388888, 317.57061631944447],
            [154.2773654513889, 326.15373263888887],
            [165.81455078125, 334.8905815972222],
            [179.41981336805554, 339.5232204861111],
            [196.83075086805556, 341.3266493055556],
            [214.15501302083334, 336.59053819444443],
            [226.73498263888888, 325.8439236111111],
            [239.3505859375, 307.00481770833335],
            [244.926953125, 291.27630208333335],
            [245.48834635416668, 278.59192708333336],
            [243.22269965277778, 270.26004774305557],
            [237.0195529513889, 263.3695095486111],
            [226.50232204861112, 257.1775607638889],
            [215.17810329861112, 253.03120659722222],
            [206.3234375, 250.42530381944445],
            [198.60894097222223, 248.8945529513889],
            [192.80284288194446, 248.72256944444445],
            [194.13333333333333, 248.88888888888889],
          ],
          width: 8,
          color: 'black',
          style: 'fill',
        },
      ],
      [
        1653138292.004,
        {
          points: [
            [108.8, 448],
            [108.8, 448],
            [109.18311631944445, 449.5049045138889],
            [110.61496310763889, 455.95855034722223],
            [114.44574652777777, 467.77452256944446],
            [119.66584201388889, 483.0864149305556],
            [124.85891927083334, 501.52664930555557],
            [129.7126519097222, 519.6819444444444],
            [133.7120876736111, 534.5758680555556],
            [136.37593315972222, 542.0065104166666],
            [139.52164713541666, 548.7812934027778],
            [142.0432074652778, 553.0654513888888],
            [145.9793185763889, 554.4637152777777],
            [151.65078125, 550.7308159722222],
            [161.84738498263889, 538.2703559027777],
            [171.49759114583333, 527.0502170138889],
            [179.9047092013889, 517.0444878472222],
            [188.16471354166666, 509.56011284722223],
            [195.352734375, 503.0802951388889],
            [199.62146267361112, 497.83272569444443],
            [203.0580078125, 492.9632378472222],
            [204.502734375, 489.80985243055557],
            [204.9777777777778, 485.68888888888887],
            [204.8, 487.1111111111111],
          ],
          width: 8,
          color: 'black',
          style: 'fill',
        },
      ],
      [
        1653138292.517,
        {
          points: [
            [169.6, 470.0444444444444],
            [169.6, 470.0444444444444],
            [169.6, 470.0444444444444],
            [170.0431423611111, 471.2862847222222],
            [172.4116970486111, 476.99930555555557],
            [176.96549479166666, 490.2182291666667],
            [182.89027777777778, 508.6660590277778],
            [188.28155381944444, 527.7854166666667],
            [193.82039930555555, 544.2061197916667],
            [197.74014756944445, 553.1184895833334],
            [201.91263020833333, 560.4025173611111],
            [204.02445746527778, 563.2326388888889],
            [207.77087673611112, 564.7828993055556],
            [215.08873697916667, 560.6283854166667],
            [223.93103298611112, 549.5743923611111],
            [235.51840277777777, 532.2480902777778],
            [249.08424479166666, 513.504296875],
            [264.0865668402778, 493.28151041666666],
            [274.58385416666664, 477.9019965277778],
            [282.19327256944445, 466.86970486111113],
            [286.6730685763889, 461.1123263888889],
            [288.93372395833336, 458.1549479166667],
            [290.95319010416665, 456.3423177083333],
            [293.3052951388889, 454.33211805555555],
            [296.35555555555555, 451.3777777777778],
            [295.46666666666664, 452.26666666666665],
          ],
          width: 8,
          color: 'black',
          style: 'fill',
        },
      ],
    ];

    canvasRef.current?.addPoints(data as CurvesDump); */
  };

  const undo = () => {
    canvasRef.current?.undo();
  };

  const redo = () => {
    canvasRef.current?.redo();
  };

  return (
    <View
      style={{
        height: 50,
        width: '100%',
        paddingHorizontal: 12,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
      }}
    >
      <View
        style={{
          flexDirection: 'row',
        }}
      >
        <TouchableOpacity
          activeOpacity={0.6}
          onPress={undo}
          style={[styles.button, { marginRight: 10 }]}
        >
          <Text style={styles.buttonText}>Undo</Text>
        </TouchableOpacity>

        <TouchableOpacity
          onPress={redo}
          activeOpacity={0.6}
          style={styles.button}
        >
          <Text style={styles.buttonText}>Redo</Text>
        </TouchableOpacity>
      </View>

      <View
        style={{
          flexDirection: 'row',
        }}
      >
        <TouchableOpacity
          onPress={reset}
          activeOpacity={0.6}
          style={styles.button}
        >
          <Text style={styles.buttonText}>Reset</Text>
        </TouchableOpacity>

        <TouchableOpacity
          activeOpacity={0.6}
          onPress={save}
          style={[styles.button, { marginLeft: 10 }]}
        >
          <Text style={styles.buttonText}>Save</Text>
        </TouchableOpacity>
      </View>
    </View>
  );
};

const styles = StyleSheet.create({
  button: {
    paddingHorizontal: 12,
    backgroundColor: 'white',
    height: 30,
    justifyContent: 'center',
    alignItems: 'center',
    borderRadius: 100,
    ...Util.getElevation(1),
  },
  buttonText: {
    color: 'black',
  },
});

export default Header;
